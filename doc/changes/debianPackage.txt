

How to create a Debian package.

- install OpenFOAM as usual
(I installed the 1.7.0 git version:
    cd ~/OpenFOAM
    git clone ssh://mattijs@10.0.0.4/home/noisy3/OpenFOAM/OpenFOAM-1.7.0.git
)

Get all your dependencies:

Package building:
    sudo apt-get install dh-make
    sudo apt-get install dpkg
    sudo apt-get install lintian        # contains package checking
    sudo apt-get install devscripts     # contains debuild package building

OpenFOAM building:

    sudo apt-get install binutils-dev
    sudo apt-get install flex
    sudo apt-get install libscotch-dev
    sudo apt-get install libparmetis-dev
    sudo apt-get install libopenmpi-dev
    sudo apt-get install libxt-dev (tecplot360 converter)

Compile all.
- metis might give problems
- parmetis might give problems
- mgridgen might give problems

- remove the .git directory

Create a directory with a tar.gz pack of all:

    cd ~/OpenFOAM
    foamPackGeneral
    mv OpenFOAM-1.7.0.General_2010-06-21.gtgz openfoam_1.7.0.orig.tar.gz
    #tar czf openfoam_1.7.0.orig.tar.gz OpenFOAM-1.7.0

Test packaging:
    # Clean build
    fakeroot debian/rules clean
    # Build : does Allwmake
    fakeroot debian/rules build
    # Create .deb from build results
    fakeroot debian/rules binary
or one one go:
    debuild -uc -us
    (does a dpdg-buildpackage -rfakeroot)





-------------------------------------------------------
** settings inside fakeroot:

echo "PWD=/home/opencfd/OpenFOAM/OpenFOAM-1.7.0"
PWD=/home/opencfd/OpenFOAM/OpenFOAM-1.7.0
set
CFLAGS='-g -O2'
CPPFLAGS=''
CXXFLAGS='-g -O2'
DEB_BUILD_ARCH='i386'
DEB_BUILD_ARCH_BITS='32'
DEB_BUILD_ARCH_CPU='i386'
DEB_BUILD_ARCH_ENDIAN='little'
DEB_BUILD_ARCH_OS='linux'
DEB_BUILD_GNU_CPU='i486'
DEB_BUILD_GNU_SYSTEM='linux-gnu'
DEB_BUILD_GNU_TYPE='i486-linux-gnu'
DEB_HOST_ARCH='i386'
DEB_HOST_ARCH_BITS='32'
DEB_HOST_ARCH_CPU='i386'
DEB_HOST_ARCH_ENDIAN='little'
DEB_HOST_ARCH_OS='linux'
DEB_HOST_GNU_CPU='i486'
DEB_HOST_GNU_SYSTEM='linux-gnu'
DEB_HOST_GNU_TYPE='i486-linux-gnu'
DH_VERBOSE='1'
FAKED_MODE='unknown-is-root'
FAKEROOTKEY='1199783323'
FFLAGS='-g -O2'
HOME='/home/opencfd'
IFS=' 	
'
LANG='en_GB.UTF-8'
LDFLAGS='-Wl,-Bsymbolic-functions'
LD_LIBRARY_PATH='/usr/lib/libfakeroot:/usr/lib64/libfakeroot:/usr/lib32/libfakeroot'
LD_PRELOAD='libfakeroot-sysv.so'
LOGNAME='opencfd'
MAKEFLAGS=''
MAKELEVEL='1'
MFLAGS=''
OPTIND='1'
PATH='/usr/sbin:/usr/bin:/sbin:/bin:/usr/bin/X11'
PPID='28953'
PS1='# '
PS2='> '
PS4='+ '
PWD='/home/opencfd/OpenFOAM/OpenFOAM-1.7.0'
SHLVL='1'
TERM='xterm'
_='debian/rules'

-------------------------------------------------------
Packaging:

    dh_make -f openfoam-1.7.0.orig.tar.gz

    cd debian
    rm emacs*
    rm cron.d.ex
    rm init.d.ex
    rm init.d.lsb.ex
    rm openfoam.default.ex
    rm postrm.ex    <- probably not sourced so we cannot use it
                       to do a foamCleanPath
    preinst.ex :
        - change etc/ files to have hardcoded current installation
            (/opt/OpenFOAM/openfoam-1.7.0)
        - source /opt/OpenFOAM/openfoam-1.7.0/etc/bashrc
    postinst.ex :
        - have it print message about users needing to add
          source /opt/OpenFOAM/openfoam-1.7.0/etc/bashrc
                    

    cp ../README README.source

    vi control
        - section=optional
        - Maintainer=patches <patches@opencfd.co.uk>
        - homepage=<http://www.openfoam.com>
        - Architecture=i386    (or amd64)
        - Depends: binutils-dev, flex, ...
        - Description: OpenFOAM-1.7.0
            OpenFOAM is a free, open source CFD software package produced by a
            commercial company, OpenCFD Ltd. It has a large user base across most
            areas of engineering and science, from both commercial and academic
            organisations. OpenFOAM has an extensive range of features to solve
            anything from complex fluid flows involving chemical reactions,
            turbulence and heat transfer, to solid dynamics and
            electromagnetics.            
    vi copyright
    - change to our v3.
    vi rules and change to makefile with rules:

        make clean:
            -> ./Allwclean
        make build:
            -> ./Allwmake
        make binary:
            -> ./Allwmake

    vi changeLog
    - update email address
    - possibly add git log

    rm watch.ex (could be used to check for updates)
    rm README.Debian <- already in our readme. Or maybe note lack of *Metis.

Test of packaging
-----------------
    dpkg - creates a .deb package:

        dpdg-buildpackage -rfakeroot

    + rename into

        openfoam-1.7.0-0ubuntu1.deb
                              ^
                       ^      package counter. incremented (by hand) for every new deb pack
                    from us


    lintian - checks .deb package






